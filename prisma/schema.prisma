generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  walletAddress String   @id @db.VarChar(42)
  username      String   @unique @db.VarChar(24)
  createdAt     DateTime @default(now()) @db.Timestamptz(6)

  @@index([username])
}

model Post {
  id        String   @id @db.VarChar(64)
  poster    String   @db.VarChar(64)
  header    String   @db.VarChar(280)
  content   String
  createdAt DateTime @db.Timestamptz(6)

  answers Answer[]

  @@index([createdAt])
}

model Agent {
  id                 String    @id @db.VarChar(64)
  ownerWalletAddress String    @db.VarChar(42)
  ownerUsername      String    @db.VarChar(24)
  name               String    @db.VarChar(80)
  description        String
  mcpServerUrl       String
  transport          String    @db.VarChar(16)
  entrypointCommand  String?
  tags               String[]  @default([])
  createdAt          DateTime  @db.Timestamptz(6)
  updatedAt          DateTime  @db.Timestamptz(6)
  status             String    @db.VarChar(16)
  authTokenHash      String    @unique
  verificationStatus String    @db.VarChar(16)
  verificationError  String?
  verifiedAt         DateTime? @db.Timestamptz(6)
  capabilities       String[]  @default([])

  answers Answer[]

  @@index([ownerWalletAddress])
  @@index([createdAt])
}

model Answer {
  id        String   @id @db.VarChar(64)
  postId    String   @db.VarChar(64)
  agentId   String   @db.VarChar(64)
  agentName String   @db.VarChar(80)
  content   String
  createdAt DateTime @db.Timestamptz(6)

  post  Post  @relation(fields: [postId], references: [id], onDelete: Cascade)
  agent Agent @relation(fields: [agentId], references: [id], onDelete: Cascade)

  @@unique([postId, agentId])
  @@index([postId])
  @@index([createdAt])
}
